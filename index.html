<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A minimalist multi-tool app for fast access to knowledge all in one place.">
    <title>The Compendium of Everything</title>
    <link rel="icon" type="image/png" href="Compendium_Logo.png">
    <style id="style">
        body {
            background: linear-gradient(to right, #5b0000, #00005b);
            color: #fff;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        (() => {
  const existing = document.getElementById("compendium-app");
  if (existing) existing.remove();

  const style = document.createElement("style");
  style.textContent = `
      /* Sans-Serif */
      @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Raleway:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Mulish:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Cabin:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Barlow:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Asap:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Karla:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Signika:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Hind:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Archivo:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Questrial&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded');


      /* Serif */
      @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Roboto+Serif:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Source+Serif+4:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Domine:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Spectral:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Cardo:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Vollkorn:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Crete+Round:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Arvo:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Old+Standard+TT:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Prata&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Zilla+Slab:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Literata:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Georgia+Pro:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Faustina:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=PT+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Neuton:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Sorts+Mill+Goudy:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Alice&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Gloock:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Trirong:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Noticia+Text:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Abhaya+Libre:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Libre+Caslon+Text:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Martel:wght@400;700&display=swap');

      /* Monospaced */
      @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Cutive+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Anonymous+Pro:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Oxygen+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Ubuntu+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Overpass+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Major+Mono+Display&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Red+Hat+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Syne+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Recursive:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=PT+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Mononoki&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Nova+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Enriqueta:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Special+Elite&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Cutive+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Oxygen+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Overpass+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Major+Mono+Display&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Red+Hat+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Syne+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Recursive:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Nova+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Enriqueta:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Special+Elite&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Mononoki&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=PT+Mono&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Anonymous+Pro:wght@400;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');

      @font-face {
      font-family: OpenDyslexic;
      src: url(OpenDyslexic-Regular.otf);
      }

     .font-selector {
      width: 100%;
      padding: 8px 14px;
      border-radius: 16px;
      border: 1px solid #bbb;
      background: var(--bg-color, #f0f0f8);
      color: var(--text-color);
      font-size: 1em;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      transition: border-color 0.2s, box-shadow 0.2s;
      margin-left: 10px;
      outline: none;
      }
     .font-selector:focus {
      border-color: var(--accent-color, royalblue);
      box-shadow: 0 0 0 2px var(--accent-color, royalblue);
      }
     .setting-item label[for="font-family-select"] {
      min-width: 60px;
      font-size: 1em;
      color: var(--text-color, #222);
      font-family: var(--text-font, 'Roboto'), sans-serif;
      margin-right: 10px;
      }
     .setting-item select.font-selector optgroup {
      font-style: normal;
      font-weight: bold;
      color: #444;
      background: #f0f0f8;
      }
     .setting-item select.font-selector option {
      font-size: 1em;
      color: #222;
      background: #fff;
      }

     #compendium-app {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(1.25);
      transform-origin: center;
      width: 400px;
      height: 600px;
      background-color: var(--bg-color, #fff);
      color: var(--text-color, #000);
      border-radius: 30px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      z-index: 999999999;
      overflow-y: auto;
      overflow-x: hidden;
      box-sizing: border-box;
      font-size: var(--font-size, 16px);
    }

     #clock-container {
      position: absolute;
      bottom: 10px;
      right: 15px;
      text-align: right;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      font-size: var(--font-size);
      font-weight: bold;
      color: #000;
      text-shadow:
      -1px -1px 0 white,
      1px -1px 0 white,
      -1px 1px 0 white,
      1px 1px 0 white;
      z-index: 1000;
    }  

     .compendium-title {
      font-size: 1.4em;
      font-weight: bold;
      font-style: italic;
      text-align: center;
      margin: 10px 0;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      color: var(--text-color);
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
    }

      #compendium-app.dark {
      --bg-color: #121212;
      --text-color: #eee;
      --accent-color: royalblue;
      --text-font: var(--text-font, 'Roboto'), sans-serif;
    }

      #compendium-app.light {
      --bg-color: #fff;
      --text-color: #000;
      --accent-color: royalblue;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

     #compendium-app header {
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      border-bottom: 1px solid #ccc;
      background-color: var(--bg-color);
      position: sticky;
      top: 0;
      z-index: 10;
    }

     #compendium-app header .tab {
      flex: 1;
      text-align: center;
      cursor: pointer;
      font-weight: 500;
      padding: 6px 0;
      color: var(--text-color);
      transition: color 0.3s;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

     #compendium-app header .tab.selected {
      color: var(--accent-color, royalblue);
      font-weight: 700;
    }

     .material-symbols-rounded {
      font-variation-settings:
        'FILL' 0,
        'wght' 400,
        'GRAD' 0,
        'opsz' 48;
      font-size: 28px;
      user-select: none;
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
    }

     #compendium-app main {
      flex: 1;
      padding: 10px 16px 120px 16px;
      overflow-y: auto;
      overflow-x: hidden;
    box-sizing: border-box;
    }

     #compendium-app input[type="search"] {
      width: 100%;
      padding: 10px 14px;
      border-radius: 24px;
      border: 1px solid #ccc;
      font-size: 1em;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      box-sizing: border-box;
      background-color: var(--bg-color);
      color: var(--text-color);
      outline-offset: 2px;
      outline-color: var(--accent-color, royalblue);
      transition: border-color 0.3s;
    }

     #compendium-app input[type="search"]::placeholder {
      color: var(--text-color);
      opacity: 0.5;
    }

     .results, .content {
      margin-top: 14px;
      margin-bottom: 1.5em;
      line-height: 1.5;
      max-width: 100%;
      box-sizing: border-box;
      word-wrap: break-word;
      overflow-wrap: break-word;
      font-family: var(--text-font, 'Roboto'), sans-serif;
    }
    
     header {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 10px;
    }

      header .tab {
      display: inline-block;
      margin: 0 5px;
    }

     #compendium-app input[type="search"] {
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

     .version-details {
      user-select: none;
      position: absolute;
      bottom: 50px;   
      left: 20px;
      max-width: 200px;
      padding: 10px 15px;
      background: var(--bg-color);
      border: 1px solid #ccc;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      font-size: 14px;
      color: var(--text-color);
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      border-radius: 18px;
      z-index: 100;
      white-space: normal;
      z-index: 999;
    }

     .version-label {
      cursor: pointer;
      user-select: none;
      position: absolute;
      bottom: 24px;
      left: 20px;
      font-size: var(--font-size);
      font-style: italic;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      color: #808080;
      z-index: 1000;
    }

     .author-title {
      font-size: var(--font-size);
      position: absolute;
      bottom: 5px;
      left: 20px;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      font-style: italic;
      color: #808080;
      z-index: 1000;
    }

     .result-item {
      padding: 8px 10px;
      border-radius: 16px;
      cursor: pointer;
      transition: background-color 0.2s;
      user-select: none;
      font-weight: 500;
    }

     .result-item:hover {
      background-color: var(--accent-color, royalblue);
      color: #fff;
    }

     .content img {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
      border: 1px solid #ccc;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      margin: 10px 0;
      display: block;
    }

     .setting-item {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: 500;
    }

     .setting-item label {
      cursor: pointer;
    }

      .toggle-switch {
      position: relative;
      width: 40px;
      height: 22px;
      background-color: #ccc;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

     .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
      position: absolute;
    }

     .toggle-slider {
      position: absolute;
      top: 1px;
      left: 1px;
      width: 20px;
      height: 20px;
      background-color: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }

    .toggle-switch input:checked + .toggle-slider {
      transform: translateX(18px);
      background-color: var(--accent-color, royalblue);
    }

      input[type="range"] {
      width: 140px;
    }

    #content.weather-content {
      max-width: 400px;
      margin: 2rem auto;
      padding: 2rem;
      border-radius: 8px;
      background: linear-gradient(to bottom, #ffffff, #f0f8ff);
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      text-align: center;
      font-family: var(--text-font, 'Roboto'), sans-serif;
  }

    #content.weather-content h3 {
      margin-bottom: 1rem;
      font-size: 1.6rem;
      color: #333;
  }

    #content.weather-content img {
      margin: 1rem 0;
      filter: drop-shadow(0 0 5px rgba(0,0,0,0.2));
  }

    #content.weather-content p {
      margin: 0.3rem 0;
      font-size: 1rem;
      color: #444;
  }

     .input-group {
      display: flex;
      align-items: center;
  }

     #location-input {
      height: 22px;
      border: 1px solid black;
      border-radius: 12px 0 0 12px;
      padding: 0 8px;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      margin: 0;
      box-sizing: border-box;
      line-height: normal;
  }
  
     #get-weather-btn {
      height: 22px;
      border: 1px solid black;
      border-left: none;
      border-radius: 0 12px 12px 0;
      background-color: royalblue;
      color: white;
      margin: 0;
      padding: 0 8px;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
      box-sizing: border-box;
      line-height: normal;
  }
     #get-weather-btn:hover {
      background-color: #3a50c1;
  }

     .input-group {
      text-align: center;
      margin-bottom: 1em;
  }

     .input-group input {
      padding: 0.5em 1em;
      font-size: 1rem;
      width: 250px;
      max-width: 90vw;
      margin-right: 0.5em;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }

     .input-group button {
      padding: 0.5em 1.2em;
      font-size: 1rem;
      cursor: pointer;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      background-color: var(--accent-color);
      color: #fff;
      border: none;
      border-radius: 4px;
      transition: background-color 0.3s ease;
  }

     .unit-toggle {
      text-align: center;
      margin-bottom: 1em;
      font-size: 0.9rem;
      user-select: none;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      color: var(--accent-color);
    }
     .unit-toggle input[type="checkbox"] {
      margin-right: 0.4em;
      transform: scale(1.2);
      cursor: pointer;
  }

     .weather-card {
      background: var(--bg-color);
      border-radius: 8px;
      max-width: 320px;
      margin: 0 auto;
      padding: 1.2em 1.5em;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      font-family: var(--text-font, 'Roboto'), sans-serif;
      color: var(--text-color);
  }

     .weather-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.6em;
      margin-bottom: 0.3em;
  }

     .weather-icon {
      font-size: 2.4rem;
      color: var(--text-color);
  }

     .loading-spinner {
      font-size: 2rem;
      animation: spin 1.5s linear infinite;
      display: inline-block;
      vertical-align: middle;
      color: var(--accent-color);
  }

      @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
  }

     .wind-container {
      margin-top: 1em;
      user-select: none;
  }

     .wind-speed {
      font-weight: 600;
      font-size: 1.3rem;
      margin-bottom: 0.2em;
      color: var(--accent-color);
      font-family: var(--text-font, 'Roboto'), sans-serif;
 }

      wind-compass {
      display: block;
      margin: 0 auto;
      max-width: 100px;
      height: 100px;
      stroke-linejoin: round;
  }

      input:focus {
      outline-color: var(--accent-color);
      border-color: var(--accent-color);
      box-shadow: 0 0 5px var(--accent-color);
  }

     .forecast-container {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-wrap: nowrap;
      margin-top: 1em;
  }
     .forecast-day {
      flex: 1 1 30%;
      margin: 0 10px;
      box-sizing: border-box;
      text-align: center;
  }
     .forecast-day strong {
      display: block;
      margin-bottom: 0.8em;
  }
     .weather-icon {
       font-size: 48px;
  }


     .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
      margin: 0;
  }

     .switch input {
      opacity: 0;
      width: 0;
      height: 0;
  }

     .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: var(--accent-color);
      transition: 0.4s;
      border-radius: 24px;
  }

     .slider::before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
  }

     .switch input:checked + .slider {
      background-color: var(--accent-color);
  }

     .switch input:checked + .slider::before {
      transform: translateX(26px);
  }

     #today-forecast {
      border: 2px solid var(--accent-color);
      background-color: var(--accent-color);
      color: white;
      border-radius: 12px;
      padding: 6px;
  }

     #notepad-btn {
      position: fixed;
      bottom: 30px;
      right: 35px;
      z-index: 1000;
      background: var(--accent-color, royalblue);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 54px;
      height: 54px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
      cursor: pointer;
      font-size: 2em;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
  }
     #notepad-btn:hover {
      background: #3a50c1;
  }
     #notepad-panel {
      position: fixed;
      bottom: 100px;
      right: 40px;
      width: 320px;
      height: 260px;
      background: var(--bg-color, #fff);
      color: var(--text-color, #000);
      border-radius: 18px;
      box-shadow: 0 4px 18px rgba(0,0,0,0.18);
      z-index: 1000002;
      display: none;
      flex-direction: column;
      overflow: hidden;
      border: 1px solid #ccc;
  }
     .notepad-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--accent-color, royalblue);
      color: #fff;
      padding: 8px 14px;
      font-weight: bold;
      font-family: var(--text-font, 'Roboto'), sans-serif;
  }
     #notepad-panel textarea {
      width: 100%;
      height: 190px;
      border: none;
      resize: none;
      padding: 12px;
      font-size: 1em;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      background: transparent;
      color: inherit;
      outline: none;
      box-sizing: border-box;
  }
     #close-notepad {
      background: none;
      border: none;
      color: #fff;
      font-size: 1.3em;
      cursor: pointer;
  }

     #notepad-btn {
      position: fixed;
      bottom: 70px;
      right: 30px;
      z-index: 1000001;
      background: var(--accent-color, royalblue);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 54px;
      height: 54px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.18);
      cursor: pointer;
      font-size: 2em;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
  }
     #notepad-btn:hover {
      background: #3a50c1;
  }
     #notepad-panel {
      position: fixed;
      bottom: 140px;
      right: 30px;
      width: 300px;
      height: 240px;
      background: var(--bg-color, #fff);
      color: var(--text-color, #000);
      border-radius: 18px;
      box-shadow: 0 4px 18px rgba(0,0,0,0.18);
      z-index: 1000002;
      display: none;
      flex-direction: column;
      overflow: hidden;
  }
  
     .about-panel {
      position: absolute;
      bottom: 50px;
      left: 50px;
      max-width: 320px;
      min-width: 220px;
      padding: 20px 18px 18px 18px;
      background: var(--bg-color, #fff);
      border: 1px solid #ccc;
      border-radius: 22px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.18);
      color: var(--text-color, #222);
      font-family: var(--text-font, 'Roboto'), sans-serif;
      z-index: 1001;
      white-space: normal;
      text-align: center;
      animation: fadeInAbout 0.2s;
  }
     @keyframes fadeInAbout {
      from { opacity: 0; transform: translateY(20px);}
      to { opacity: 1; transform: translateY(0);}
  }
     .about-logo {
      width: 64px;
      height: 64px;
      object-fit: contain;
      border-radius: 12px;
      margin-bottom: 8px;
  }
     .about-close {
      position: absolute;
      top: 8px;
      right: 12px;
      cursor: pointer;
      font-size: 1.4em;
      color: #888;
      transition: color 0.2s;
  }
     .about-close:hover {
      color: var(--accent-color, royalblue);
  }

    .notepad-header button {
     background: #f5f5f7;
     border: none;
     border-radius: 12px;
     margin-left: 6px;
     padding: 6px 10px;
     cursor: pointer;
     font-size: 1.1em;
     color: #333;
     transition: background 0.2s, box-shadow 0.2s;
     vertical-align: middle;
     display: inline-flex;
     align-items: center;
  }

    .notepad-header button:hover {
     background: #e0e0e7;
     box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  }

    .notepad-header button:active {
     background: #d0d0d7;
  }

    .notepad-header .material-symbols-rounded {
     font-size: 1.3em;
     margin-right: 2px;
  }

      .font-family-settings {
      display: flex;
      flex-direction: column;
      max-width: 300px;
      margin-bottom: 1em;
      font-family: Arial, sans-serif;
  }

     .font-family-settings #font-family-search {
      padding: 6px 10px;
      margin-bottom: 8px;
      font-size: 0.9rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      outline-offset: 2px;
      transition: border-color 0.2s ease;
  }

     .font-family-settings #font-family-search:focus {
      border-color: #3a86ff;
      box-shadow: 0 0 4px #3a86ffaa;
  }

     .font-family-settings #font-family-select {
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #ccc;
  }

     #simple-version-btn {
      background: linear-gradient(90deg, #3a86ff 0%, #4361ee 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 8px 18px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(58,134,255,0.08);
      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
      margin-left: 10px;
  }

     #simple-version-btn:hover,
     #simple-version-btn:focus {
      background: linear-gradient(90deg, #4361ee 0%, #3a86ff 100%);
      box-shadow: 0 4px 16px rgba(58,134,255,0.15);
      transform: translateY(-2px) scale(1.04);
      outline: none;
  }

     #footer-overlay {
      position: absolute;
      left: 0;
      right: 16px;
      bottom: 0;
      height: 120px;
      background: linear-gradient(
        to top,
        var(--bg-color) 0%,
        var(--bg-color) 40px,
        transparent 100%
    );
      z-index: 100;
      pointer-events: none;
      border-radius: 0 0 30px 30px;
      box-shadow: none;
  }

     .setting-item input[type="color"] {
      appearance: none;
      border: 1.5px solid var(--accent-color);
      border-radius: 8px;
      width: 32px;
      height: 32px;
      padding: 0;
      background: none;
      cursor: pointer;
      margin-left: 8px;
      transition: border-color 0.2s, box-shadow 0.2s;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  }

     .setting-item input[type="color"]:focus {
      outline: none;
      border-color: #3a86ff;
      box-shadow: 0 0 0 2px #3a86ff44;
  }
     .setting-item label {
      display: flex;
      align-items: center;
      font-size: 1em;
      font-family: var(--text-font, 'Roboto'), sans-serif;
      color: var(--text-color);
  }

     #reset-theme-btn {
      background: var(--accent-color);
      color: var(--text-color);
      border: none;
      border-radius: 8px;
      padding: 6px 16px;
      font-size: 1em;
      font-weight: 500;
      cursor: pointer;
      margin-top: 6px;
      transition: background 0.2s, box-shadow 0.2s;
  }

     #reset-theme-btn:hover, #reset-theme-btn:focus {
      background: #3a50c1;
      box-shadow: 0 2px 8px rgba(58,134,255,0.10);
      outline: none;
  }

  `;

  document.head.appendChild(style);

  const app = document.createElement("section");
  app.id = "compendium-app";
  app.classList.add("light");

  app.innerHTML = `

  <header>
  <div class="tab selected" data-tab="wiki" title="Wikipedia">
    <span class="material-symbols-rounded" aria-label="Wikipedia">language</span>
  </div>
  <div class="tab" data-tab="dic" title="Dictionary">
    <span class="material-symbols-rounded" aria-label="Dictionary">dictionary</span>
  </div>
  <div class="tab" data-tab="thes" title="Thesaurus">
    <span class="material-symbols-rounded" aria-label="Thesaurus">library_books</span>
  </div>
  <div class="tab" data-tab="weather" title="Weather">
    <span class="material-symbols-rounded" aria-label="Weather">partly_cloudy_day</span>
  </div>
  <div class="tab" data-tab="sett" title="Settings">
    <span class="material-symbols-rounded" aria-label="Settings">settings</span>
  </div>
</header>
    <main>
      <div class="compendium-title">The Compendium of Everything</div>
      <input type="search" placeholder="Search Encyclopedia..." id="search-input" autocomplete="off" />
      <div class="results"></div>
      <div class="content"></div>
      <div class="settings" style="display:none;"></div>
      <div id="clock-container">
      <div id="time"></div>
      <div id="date"></div>
    </div>

      <div class="version-label" id="versionLabel">v.2.1.1</div>
      <div id="versionDetails" class="version-details" style="display:none;"></div>
      <div class="author-title">Made by L. Smalley</div>
      <div id="footer-overlay"></div>
    </main>
  `;

  document.body.appendChild(app);

  const notepadBtn = document.createElement("button");
notepadBtn.id = "notepad-btn";
notepadBtn.title = "Open Notepad";
notepadBtn.innerHTML = `<span class="material-symbols-rounded">edit_note</span>`;
app.appendChild(notepadBtn);

const notepadPanel = document.createElement("div");
notepadPanel.id = "notepad-panel";
notepadPanel.innerHTML = `
<div class="notepad-header">
  <span>Notepad</span>
  <div>
    <button id="export-notes" title="Export Notes"><span class="material-symbols-rounded">download</span></button>
    <button id="import-notes" title="Import Notes"><span class="material-symbols-rounded">upload</span></button>
    <button id="close-notepad" title="Close"><span class="material-symbols-rounded">close</span></button>
  </div>
</div>
<textarea id="notepad-text" placeholder="Type your notes here..."></textarea>

`;
app.appendChild(notepadPanel);


notepadPanel.querySelector("#export-notes").addEventListener("click", exportNotes);
notepadPanel.querySelector("#import-notes").addEventListener("click", importNotes);


// Notepad logic
const notepadText = notepadPanel.querySelector("#notepad-text");
const closeNotepad = notepadPanel.querySelector("#close-notepad");

// Load saved notes
notepadText.value = localStorage.getItem("compendium-notepad") || "";

// Save notes on input
notepadText.addEventListener("input", () => {
  localStorage.setItem("compendium-notepad", notepadText.value);
});

// Show/hide panel
notepadBtn.addEventListener("click", () => {
  notepadPanel.style.display = "flex";
});
closeNotepad.addEventListener("click", () => {
  notepadPanel.style.display = "none";
});

// Export notes as .txt file
function exportNotes() {
  const text = localStorage.getItem("compendium-notepad") || "";
  const blob = new Blob([text], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "compendium-notes.txt";
  document.body.appendChild(a);
  a.click();
  setTimeout(() => {
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }, 0);
}

// Import notes from .txt file
function importNotes() {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = ".txt,text/plain";
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (evt) => {
      const text = evt.target.result;
      localStorage.setItem("compendium-notepad", text);
      notepadText.value = text;
    };
    reader.readAsText(file);
  };
  input.click();
}

const tabs = app.querySelectorAll(".tab");
const searchInput = app.querySelector("#search-input");
const resultsDiv = app.querySelector(".results");
const contentDiv = app.querySelector(".content");
const settingsDiv = app.querySelector(".settings");

let currentTab = "wiki";

let darkMode = false;
let fontSize = 14; // px
let appSize = 1.25; //scale
let fontFamily = "Roboto";

// Store content for each tab
const tabContents = {
  wiki: { results: "", content: "" },
  dic: { results: "", content: "" },
  thes: { results: "", content: "" },
  weather: { results: "", content: "" },
  sett: { results: "", content: "" }
};

function switchTab(tab) {
  // Save current tab's content
  if (tabContents[currentTab]) {
    tabContents[currentTab].results = resultsDiv.innerHTML;
    tabContents[currentTab].content = contentDiv.innerHTML;
  }

  currentTab = tab;
  tabs.forEach((t) => t.classList.toggle("selected", t.dataset.tab === tab));
  settingsDiv.style.display = "none";
  searchInput.style.display = "block";
  searchInput.value = "";

  // Restore content for the new tab
  if (tab === "wiki") {
    searchInput.placeholder = "Search Wikipedia...";
    searchInput.disabled = false;
    resultsDiv.innerHTML = tabContents.wiki.results;
    contentDiv.innerHTML = tabContents.wiki.content;
    settingsDiv.style.display = "none";
  } else if (tab === "dic") {
    searchInput.placeholder = "Search Dictionary...";
    searchInput.disabled = false;
    resultsDiv.innerHTML = tabContents.dic.results;
    contentDiv.innerHTML = tabContents.dic.content;
    settingsDiv.style.display = "none";
  } else if (tab === "thes") {
    searchInput.placeholder = "Search Thesaurus...";
    searchInput.disabled = false;
    resultsDiv.innerHTML = tabContents.thes.results;
    contentDiv.innerHTML = tabContents.thes.content;
    settingsDiv.style.display = "none";
  } else if (tab === "weather") {
    searchInput.style.display = "none";
    resultsDiv.innerHTML = tabContents.weather.results;
    contentDiv.innerHTML = tabContents.weather.content;
    settingsDiv.style.display = "none";
    if (!contentDiv.innerHTML) loadWeather();

    // --- Weather auto-refresh: start timer when entering weather tab ---
    if (typeof weatherRefreshTimer !== "undefined" && weatherRefreshTimer) {
      clearInterval(weatherRefreshTimer);
      weatherRefreshTimer = null;
    }
    weatherRefreshTimer = setInterval(() => {
      if (typeof lastWeatherLocation !== "undefined" && lastWeatherLocation) {
        // Ensure unit toggle matches last used unit
        const unitToggle = document.getElementById("unit-toggle");
        if (unitToggle && typeof lastWeatherUnit !== "undefined") {
          unitToggle.checked = lastWeatherUnit;
        }
        fetchWeather(lastWeatherLocation, true);
      }
    }, 120000); // 2 minutes
  } else if (tab === "sett") {
    searchInput.style.display = "none";
    settingsDiv.style.display = "block";
    resultsDiv.innerHTML = "";
    contentDiv.innerHTML = "";
    loadSettings();
  }
}

tabs.forEach((tab) => {
  tab.addEventListener("click", () => switchTab(tab.dataset.tab));
});


// Wikipedia API
async function wikiSearch(query) {
  if (!query) {
    resultsDiv.innerHTML = "";
    contentDiv.innerHTML = "";
    return;
  }
  resultsDiv.innerHTML = "Searching...";
  contentDiv.innerHTML = "";
  try {
    const searchRes = await fetch(
      `https://en.wikipedia.org/w/api.php?action=query&format=json&origin=*&list=search&srsearch=${encodeURIComponent(
        query
      )}&utf8=1&srlimit=10`
    );
    const searchData = await searchRes.json();

    // Start with an empty results array
    let resultsArr = [];

    // Inject the easter egg if the query matches (case-insensitive, partial match allowed)
    if (
      query.trim().toLowerCase().includes("compendium of everything") ||
      query.trim().toLowerCase() === "compendium"
    ) {
      resultsArr.push({
        title: "The Compendium of Everything",
        isEasterEgg: true
      });
    }

    // Add Wikipedia results
    if (searchData.query.search.length) {
      resultsArr = resultsArr.concat(
        searchData.query.search.map(item => ({
          title: item.title,
          isEasterEgg: false
        }))
      );
    }

    if (!resultsArr.length) {
      resultsDiv.innerHTML = "<i>No results found.</i>";
      return;
    }

    resultsDiv.innerHTML = "";
    resultsArr.forEach((item) => {
      const div = document.createElement("div");
      div.className = "result-item";
      div.textContent = item.title;
      div.addEventListener("click", () => wikiLoadArticle(item.title));
      // Optionally, style the easter egg result differently:
      if (item.isEasterEgg) {
      }
      resultsDiv.appendChild(div);
    });
  } catch (e) {
    resultsDiv.innerHTML = `<i>Error fetching Wikipedia results.</i>`;
  }
}

async function wikiLoadArticle(title) {
  resultsDiv.innerHTML = ""; // clear search results
  contentDiv.innerHTML = "Loading article...";

  // Easter egg article
  if (title.trim().toLowerCase() === "the compendium of everything") {
    contentDiv.innerHTML = `
      <img src="Compendium_Logo.png" alt="Compendium Logo" class="about-logo" style="display:block;margin:0 auto 18px auto;">
      <h1>The Compendium of Everything</h1>
      <p>
        <b>The Compendium of Everything</b> is a multi-tool web application created by Liam C. Smalley in 2025. Designed as a digital Swiss Army knife, it provides users with quick access to a variety of resources, including Wikipedia, a dictionary, a thesaurus, weather forecasts, and a notepad—all within a single, streamlined interface.
      </p>
      <h2>History</h2>
      <p>
        The project began in late May 2025, when Smalley released version Beta 1.0 as a modest side project. The initial version was built using <a href="https://p5js.org/" target="_blank">p5.js</a>, a JavaScript library for creative coding. The first GitHub repository was minimal, containing only basic usage instructions, a logo (which has since evolved), and a single JavaScript file.
      </p>
      <p>
        Upon its release, The Compendium of Everything received no publicity and was largely overlooked. Smalley briefly considered abandoning the project, but ultimately decided to continue development, believing that its utility would eventually be recognized.
      </p>
      <h2>Development and Features</h2>
      <p>
        In early June 2025, Smalley dedicated significant effort to improving the application. One of the first major updates was the addition of a weather tab, allowing users to check current conditions and forecasts for any location. Around this time, Smalley discovered that his financial situation was better than expected, which enabled him to purchase a domain name and begin hosting The Compendium of Everything as a standalone web app. His website went live officially on 6th June, 2025 at 5:00 PM EST exactly.
      </p>
      <p>
        Over subsequent versions, the application expanded to include a font selector, dark mode, customizable text size, and a persistent notepad. The interface was refined for clarity and accessibility, and the project’s logo was updated to reflect its evolving identity.
      </p>
      <h2>Author and Pseudonym</h2>
      <p>
        The creator, Liam C. Smalley, is also known online by the pseudonym <b>Pidgeron</b>, which serves as his GitHub username and digital moniker for his programming projects.
      </p>
      <h2>Design Philosophy</h2>
      <p>
        The Compendium of Everything was conceived as a tool for “knowledge at your fingertips.” Its design emphasizes speed, simplicity, and versatility, allowing users to search Wikipedia, look up word definitions, find synonyms and antonyms, check the weather, and jot down notes—all without leaving the app. The project’s open-source nature encourages community feedback and contributions.
      </p>
      <h2>See Also</h2>
      <ul>
        <li><a href="https://github.com/Pidgeron/The-Compendium-of-Everything" target="_blank">Official GitHub Repository</a></li>
        <li><a href="https://editor.p5js.org/L_Smalley/full/o1UZH4J8M" target="_blank">Original Beta Version</a></li>
      </ul>
      <hr>
      <p style="font-size:0.9em;color:#888;">
        This article is an easter egg, appearing only when you search for "The Compendium of Everything" within the app.
      </p>
    `;
    return;
  }

  try {
    const articleRes = await fetch(
      `https://en.wikipedia.org/w/api.php?action=parse&format=json&origin=*&page=${encodeURIComponent(title)}&prop=text`
    );
    const data = await articleRes.json();
    let html = data?.parse?.text?.["*"] || "<i>Could not load content.</i>";

    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");

    doc.querySelectorAll(".mw-editsection").forEach((el) => el.remove());

    doc.querySelectorAll("img").forEach((img) => {
      let src = img.getAttribute("src");
      if (!src) return;

      if (src.startsWith("//")) src = "https:" + src;
      else if (src.startsWith("/")) src = "https://en.wikipedia.org" + src;
      else if (!src.startsWith("http")) src = "https://en.wikipedia.org/" + src.replace(/^\/*/, "");

      const thumbMatch = src.match(/^(.*)\/thumb\/(.*?\/.*?)(?:\/[^\/]+)?$/);
      if (thumbMatch) {
        src = `${thumbMatch[1]}/${thumbMatch[2]}`;
      }

      img.setAttribute("src", src);
    });

    doc.querySelectorAll("a").forEach((a) => {
      a.removeAttribute("href");
      a.style.cursor = "default";
      a.style.color = "inherit";
      a.style.textDecoration = "none";
    });

    contentDiv.innerHTML = doc.body.innerHTML;

    // ===== Table of Contents (inline-based) =====

    // Remove old ToC button/panel if present
    const oldBtn = contentDiv.querySelector("#toc-toggle-btn");
    if (oldBtn) oldBtn.remove();
    const oldPanel = contentDiv.querySelector("#toc-panel");
    if (oldPanel) oldPanel.remove();

    // Create ToC button (fixed, bottom right of viewport)
    const tocBtn = document.createElement("button");
    tocBtn.id = "toc-toggle-btn";
    tocBtn.title = "Show Table of Contents";
    tocBtn.innerHTML = `<span class="material-symbols-rounded">toc</span>`;
tocBtn.style.cssText = `
  position: fixed;
  bottom: 70px;
  left: 35px;
  z-index: 1000;
  background: var(--accent-color, royalblue);
  color: #fff;
  border: none;
  border-radius: 50%;
  width: 54px;
  height: 54px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
  cursor: pointer;
  font-size: 2em;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s;
`;

    // Create ToC panel (absolute inside .content)
const tocPanel = document.createElement("div");
tocPanel.id = "toc-panel";
tocPanel.style.cssText = `
  position: absolute;
  top: 24px;
  left: 24px;
  width: 240px;
  max-height: 70%;
  background: var(--bg-color, #fff);
  color: var(--text-color);
  border-radius: 18px;
  box-shadow: 0 4px 18px rgba(0,0,0,0.18);
  z-index: 1001;
  display: none;
  flex-direction: column;
  overflow: auto;
  border: 1px solid #ccc;
  padding: 12px 0 12px 0;
`;
    tocPanel.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;padding:0 18px 8px 18px;font-weight:bold;">
        <span>Contents</span>
        <button id="toc-close-btn" style="background:none;border:none;font-size:1.3em;cursor:pointer;color:#888;">
          <span class="material-symbols-rounded">close</span>
        </button>
      </div>
      <div id="toc-list" style="padding:0 18px;"></div>
    `;

    // Insert into .content
    contentDiv.appendChild(tocBtn);
    contentDiv.appendChild(tocPanel);

    // Show/hide panel
    tocBtn.onclick = () => {
      tocPanel.style.display = tocPanel.style.display === "block" ? "none" : "block";
    };
    tocPanel.querySelector("#toc-close-btn").onclick = () => {
      tocPanel.style.display = "none";
    };

    // Build ToC from headings in content
    const tocList = tocPanel.querySelector("#toc-list");
    tocList.innerHTML = "";
    const headings = Array.from(contentDiv.querySelectorAll("h2, h3, h4"));
    if (headings.length) {
      headings.forEach((h, i) => {
        if (!h.id) h.id = "toc-h-" + i;
        const indent = h.tagName === "H2" ? 0 : h.tagName === "H3" ? 1 : 2;
        const a = document.createElement("a");
        a.textContent = h.textContent.replace(/\[.*\]/, "").trim();
        a.style.marginLeft = `${indent * 16}px`;
        a.style.display = "block";
        a.style.color = "black";
        a.style.textDecoration = "none";
        a.style.marginBottom = "6px";
        a.style.cursor = "pointer";
        a.href = "#" + h.id;
        a.onmouseenter = () => (a.style.textDecoration = "underline");
        a.onmouseleave = () => (a.style.textDecoration = "none");
        a.onclick = (e) => {
          e.preventDefault();
          h.scrollIntoView({ behavior: "smooth", block: "start" });
          tocPanel.style.display = "none";
        };
        tocList.appendChild(a);
      });
    } else {
      tocBtn.style.display = "none";
    }

  } catch (e) {
    contentDiv.innerHTML = "<i>Error loading article.</i>";
  }
}

//Dictionary API (Free Dictionary API)
  async function dicSearch(query) {
    if (!query) {
      resultsDiv.innerHTML = "";
      contentDiv.innerHTML = "";
      return;
    }
    resultsDiv.innerHTML = "Searching...";
    contentDiv.innerHTML = "";
    try {
      const res = await fetch(
        `https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(
          query
        )}`
      );
      if (res.status === 404) {
        resultsDiv.innerHTML = "<i>No definitions found.</i>";
        return;
      }
      const data = await res.json();

      resultsDiv.innerHTML = "";

      displayDictionary(data[0]);
    } catch (e) {
      resultsDiv.innerHTML = "<i>Error fetching dictionary data.</i>";
    }
  }

  function displayDictionary(entry) {
    if (!entry) {
      contentDiv.innerHTML = "<i>No data.</i>";
      return;
    }
    let html = `<h2>${entry.word}</h2>`;
    if (entry.phonetics && entry.phonetics[0]?.text) {
      html += `<p><i>Pronunciation: ${entry.phonetics[0].text}</i></p>`;
    }
    if (entry.meanings && entry.meanings.length) {
      entry.meanings.forEach((meaning) => {
        html += `<h3>${meaning.partOfSpeech}</h3><ul>`;
        meaning.definitions.forEach((def) => {
          html += `<li>${def.definition}`;
          if (def.example) html += `<br><em>Example: ${def.example}</em>`;
          html += `</li>`;
        });
        html += `</ul>`;
      });
    }
    contentDiv.innerHTML = html;
  }

  // Thesaurus API (Datamuse API)
  async function thesSearch(query) {
    if (!query) {
      resultsDiv.innerHTML = "";
      contentDiv.innerHTML = "";
      return;
    }

    resultsDiv.innerHTML = "Searching...";
    contentDiv.innerHTML = "";

    try {
      const [synRes, antRes] = await Promise.all([
        fetch(
          `https://api.datamuse.com/words?rel_syn=${encodeURIComponent(
            query
          )}&max=20`
        ),
        fetch(
          `https://api.datamuse.com/words?rel_ant=${encodeURIComponent(
            query
          )}&max=20`
        ),
      ]);

      const synData = await synRes.json();
      const antData = await antRes.json();

      resultsDiv.innerHTML = "";

      let html = `<h2>Thesaurus for "${query}"</h2>`;

      if (synData.length) {
        html +=
          `<h3>Synonyms</h3><ul>` +
          synData.map((w) => `<li>${w.word}</li>`).join("") +
          `</ul>`;
      } else {
        html += `<h3>Synonyms</h3><p><i>No synonyms found.</i></p>`;
      }

      if (antData.length) {
        html +=
          `<h3>Antonyms</h3><ul>` +
          antData.map((w) => `<li>${w.word}</li>`).join("") +
          `</ul>`;
      } else {
        html += `<h3>Antonyms</h3><p><i>No antonyms found.</i></p>`;
      }

      contentDiv.innerHTML = html;
    } catch (e) {
      resultsDiv.innerHTML = "<i>Error fetching thesaurus data.</i>";
    }
  }

async function loadWeather() {
  contentDiv.innerHTML = `
   <div class="input-group">
      <input type="text" id="location-input" placeholder="Enter ZIP or City">
      <button id="get-weather-btn">Get Weather</button>
    </div>
    <div class="unit-toggle">
      <span>Metric</span>
      <label class="switch">
        <input type="checkbox" id="unit-toggle">
        <span class="slider"></span>
      </label>
      <span>Imperial</span>
    </div>
    <div id="weather-output" class="weather-card" style="text-align:center;">
      <i>Enter a location to get weather.</i>
    </div>
  `;

  let lastWeatherLocation = "";
  let lastWeatherUnit = false; // false = metric, true = imperial
  let weatherRefreshTimer = null;

  const input = document.getElementById("location-input");
  const button = document.getElementById("get-weather-btn");
  const output = document.getElementById("weather-output");
  const unitToggle = document.getElementById("unit-toggle");

  const windDirDegrees = {
    N: 0, NNE: 22.5, NE: 45, ENE: 67.5,
    E: 90, ESE: 112.5, SE: 135, SSE: 157.5,
    S: 180, SSW: 202.5, SW: 225, WSW: 247.5,
    W: 270, WNW: 292.5, NW: 315, NNW: 337.5,
  };

  const weatherIcons = {
    Clear: "wb_sunny",
    "Partly cloudy": "partly_cloudy_day",
    Overcast: "cloud_queue",
    Cloudy: "cloud",
    Fog: "foggy",
    Mist: "foggy",
    Drizzle: "rainy",
    Rain: "rainy",
    Snow: "snowing",
    Thunderstorm: "thunderstorm",
    default: "wb_cloudy",
  };

  const weatherCodeDescriptions = {
    0: "Clear sky", 1: "Mainly clear", 2: "Partly cloudy", 3: "Overcast",
    45: "Fog", 48: "Depositing rime fog", 51: "Light drizzle",
    53: "Moderate drizzle", 55: "Dense drizzle", 56: "Light freezing drizzle",
    57: "Dense freezing drizzle", 61: "Slight rain", 63: "Moderate rain",
    65: "Heavy rain", 66: "Light freezing rain", 67: "Heavy freezing rain",
    71: "Slight snowfall", 73: "Moderate snowfall", 75: "Heavy snowfall",
    77: "Snow grains", 80: "Slight rain showers", 81: "Moderate rain showers",
    82: "Violent rain showers", 85: "Slight snow showers", 86: "Heavy snow showers",
    95: "Thunderstorm", 96: "Thunderstorm with slight hail", 99: "Thunderstorm with heavy hail"
  };

  function describeWeather(code) {
    return weatherCodeDescriptions[code] || `Unknown (${code})`;
  }

  function getWindDirection(degrees) {
    const dirs = Object.entries(windDirDegrees);
    let closest = "N";
    let minDiff = 360;
    for (const [dir, deg] of dirs) {
      const diff = Math.abs(deg - degrees);
      if (diff < minDiff) {
        minDiff = diff;
        closest = dir;
      }
    }
    return closest;
  }

  function getWeatherIcon(desc) {
    for (const key in weatherIcons) {
      if (desc.toLowerCase().includes(key.toLowerCase()))
        return weatherIcons[key];
    }
    return weatherIcons["default"];
  }

function formatDate(dateStr) {
  const date = new Date(dateStr);
  const day = date.getDate();
  const month = date.toLocaleString("en-GB", { month: "short" });
  const weekday = date.toLocaleString("en-GB", { weekday: "short" });

  function getOrdinalSuffix(n) {
    if (n >= 11 && n <= 13) return "th";
    switch (n % 10) {
      case 1: return "st";
      case 2: return "nd";
      case 3: return "rd";
      default: return "th";
    }
  }

  return `${weekday}, ${day}${getOrdinalSuffix(day)} ${month}`;
}


  async function fetchWeather(query, silent = false) {
    if (!query) {
      output.innerHTML = `<i>Please enter a location.</i>`;
      return;
    }

    if (!silent) {
      output.innerHTML = `
      <span class="material-symbols-rounded loading-spinner">autorenew</span>
      <div>Loading weather...</div>`;
  }

    try {
      const geoRes = await fetch(
        `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=1`
      );
      const geoData = await geoRes.json();
      if (!geoData.results || geoData.results.length === 0)
        throw new Error("Location not found.");

      const loc = geoData.results[0];
      const lat = loc.latitude;
      const lon = loc.longitude;
      const locationName = `${loc.name}${loc.admin1 ? ", " + loc.admin1 : ""}${loc.country ? ", " + loc.country : ""}`;
      const useImperial = unitToggle.checked;

      const weatherRes = await fetch(
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto`
      );
      const weatherData = await weatherRes.json();
      const cw = weatherData.current_weather;

      const desc = describeWeather(cw.weathercode);
      const iconName = getWeatherIcon(desc);

      const tempC = cw.temperature;
      const windKmph = cw.windspeed;
      const windDirDeg = cw.winddirection;
      const windDir = getWindDirection(windDirDeg);

      const temp = useImperial
        ? `${Math.ceil((tempC * 9) / 5 + 32)}°F`
        : `${Math.ceil(tempC)}°C`;

      const windSpeed = useImperial
        ? (windKmph * 0.621371).toFixed(1)
        : windKmph.toFixed(1);

      const windUnit = useImperial ? "mph" : "km/h";

      const todayStr = new Date().toLocaleDateString('en-CA'); // Local timezone, format: YYYY-MM-DD

      let forecastHTML = `<h4>3-Day Forecast</h4><div class="forecast-container">`;
      const daily = weatherData.daily;
      for (let i = 0; i < 3; i++) {
        const dayRaw = daily.time[i];
        const formattedDate = formatDate(dayRaw);
        const maxC = daily.temperature_2m_max[i];
        const minC = daily.temperature_2m_min[i];
        const weatherCode = daily.weathercode[i];
        const weatherDesc = describeWeather(weatherCode);
        const forecastIcon = getWeatherIcon(weatherDesc);

        const max = useImperial
          ? `${Math.ceil((maxC * 9) / 5 + 32)}°F`
          : `${Math.ceil(maxC)}°C`;
        const min = useImperial
          ? `${Math.ceil((minC * 9) / 5 + 32)}°F`
          : `${Math.ceil(minC)}°C`;

        const todayId = i === 1 ? `id="today-forecast"` : "";


        forecastHTML += `
          <div class="forecast-day" ${todayId}>
            <strong>${formattedDate}</strong>
            <span class="material-symbols-rounded weather-icon">${forecastIcon}</span><br>
            ${weatherDesc}<br>
            High: ${max}<br>
            Low: ${min}
          </div>`;
      }
      forecastHTML += `</div>`;

      lastWeatherLocation = query;
      lastWeatherUnit = unitToggle.checked;

      output.innerHTML = `
  <div class="weather-header">
    <h3>Weather in ${locationName}</h3>
  </div>
  <p><strong>${desc}</strong></p>
  <span class="material-symbols-rounded weather-icon">${iconName}</span>
  <p>Temperature: ${temp}</p>
  <p>Wind: ${windSpeed} ${windUnit} (${windDir})</p>
  <div class="wind-container" style="width:120px; margin:auto;">
    <svg class="wind-compass" viewBox="0 0 100 100" width="120" height="120" aria-label="Wind direction compass" role="img">
      <circle cx="50" cy="50" r="48" fill="none" stroke="#666" stroke-width="2"/>
      <line x1="80" y1="20" x2="72" y2="28" stroke="#666" stroke-width="1.5"/>
      <line x1="80" y1="80" x2="72" y2="72" stroke="#666" stroke-width="1.5"/>
      <line x1="20" y1="80" x2="28" y2="72" stroke="#666" stroke-width="1.5"/>
      <line x1="20" y1="20" x2="28" y2="28" stroke="#666" stroke-width="1.5"/>
      <text x="50" y="25" text-anchor="middle" font-weight="bold" font-size="14" fill="#666" font-family="sans-serif">N</text>
      <text x="85" y="55" text-anchor="middle" font-weight="bold" font-size="14" fill="#666" font-family="sans-serif">E</text>
      <text x="50" y="85" text-anchor="middle" font-weight="bold" font-size="14" fill="#666" font-family="sans-serif">S</text>
      <text x="15" y="55" text-anchor="middle" font-weight="bold" font-size="14" fill="#666" font-family="sans-serif">W</text>
      <circle cx="50" cy="50" r="6" fill="var(--accent-color)"/>
      <g transform="rotate(${windDirDeg}, 50, 50)">
        <polygon points="50,14 47,50 53,50" fill="var(--accent-color)" stroke="var(--accent-color)" stroke-width="2"/>
      </g>
    </svg>
  </div>
  <div class="forecast">${forecastHTML}</div>
`;

  } catch (err) {
    if (!silent) {
      output.innerHTML = `<i>Could not load weather. Try a ZIP code if City doesn't work.</i>`;
    }
    // If silent, do not change the UI on error
  }
}

  button.addEventListener("click", () => fetchWeather(input.value));
  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") fetchWeather(input.value);
  });

  unitToggle.addEventListener("change", () => {
    if (input.value.trim()) {
      fetchWeather(input.value);
    }
  });

  // Clear any previous timer
if (weatherRefreshTimer) clearInterval(weatherRefreshTimer);

// Set up auto-refresh every 2 minutes (120,000 ms)
weatherRefreshTimer = setInterval(() => {
  if (lastWeatherLocation) {
    unitToggle.checked = lastWeatherUnit;
    fetchWeather(lastWeatherLocation, true); // silent refresh
  }
}, 120000); // 2 minutes

}  

function loadSettings() {
  // Get current theme values or defaults
  const accentColor = app.style.getPropertyValue("--accent-color") || "royalblue";
  const textColor = app.style.getPropertyValue("--text-color") || "#000000";
  const bgColor = app.style.getPropertyValue("--bg-color") || "#ffffff";

  settingsDiv.innerHTML = `
    <div class="setting-item">
      <label for="dark-mode-toggle">Dark Mode</label>
      <label class="toggle-switch">
        <input type="checkbox" id="dark-mode-toggle" ${darkMode ? "checked" : ""} ${localStorage.getItem("custom-theme") ? "disabled" : ""}>
        <span class="toggle-slider"></span>
      </label>
    </div>
    <div class="setting-item">
      <label for="font-size-range">Text Size (${fontSize}px)</label>
      <input type="range" id="font-size-range" min="10" max="25" value="${fontSize}">
    </div>
    <div class="setting-item" style="flex-direction:column;align-items:flex-start;">
      <div style="font-weight:bold;margin-bottom:6px;">Theme</div>
      <label style="margin-bottom:4px;">Accent Color: <input type="color" id="accent-color-picker" value="${accentColor.trim() || "#4169e1"}"></label>
      <label style="margin-bottom:4px;">Text Color: <input type="color" id="text-color-picker" value="${textColor.trim() || "#000000"}"></label>
      <label style="margin-bottom:4px;">Background Color: <input type="color" id="bg-color-picker" value="${bgColor.trim() || "#ffffff"}"></label>
      <button id="reset-theme-btn" style="margin-top:6px; font-family: var(--text-font, 'Roboto'), sans-serif;">Reset to Default</button>
      <div style="font-size:0.9em;color:#888;margin-top:2px;">Custom theme disables dark mode toggle.</div>
    </div>
    <div class="setting-item font-family-settings">
      <label for="font-family-search">Search Fonts:</label>
      <input type="text" id="font-family-search" placeholder="Type to filter fonts…" autocomplete="off" style="font-family: var(--text-font, 'Roboto'), sans-serif;" />
      <label for="font-family-select">Font Family:</label>
      <select id="font-family-select" class="font-selector" size="10">
        <optgroup label="Sans-Serif">
          <option value="Roboto" style="font-family:Roboto, sans-serif;">Roboto</option>
          <option value="'Open Sans', sans-serif" style="font-family:'Open Sans', sans-serif;">Open Sans</option>
          <option value="'Montserrat', sans-serif" style="font-family:'Montserrat', sans-serif;">Montserrat</option>
          <option value="'Lato', sans-serif" style="font-family:'Lato', sans-serif;">Lato</option>
          <option value="'Nunito', sans-serif" style="font-family:'Nunito', sans-serif;">Nunito</option>
          <option value="'Quicksand', sans-serif" style="font-family:'Quicksand', sans-serif;">Quicksand</option>
          <option value="'Raleway', sans-serif" style="font-family:'Raleway', sans-serif;">Raleway</option>
          <option value="'Work Sans', sans-serif" style="font-family:'Work Sans', sans-serif;">Work Sans</option>
          <option value="'Source Sans 3', sans-serif" style="font-family:'Source Sans 3', sans-serif;">Source Sans 3</option>
          <option value="'Ubuntu', sans-serif" style="font-family:'Ubuntu', sans-serif;">Ubuntu</option>
          <option value="'Inter', sans-serif" style="font-family:'Inter', sans-serif;">Inter</option>
          <option value="'Mulish', sans-serif" style="font-family:'Mulish', sans-serif;">Mulish</option>
          <option value="'Cabin', sans-serif" style="font-family:'Cabin', sans-serif;">Cabin</option>
          <option value="'Barlow', sans-serif" style="font-family:'Barlow', sans-serif;">Barlow</option>
          <option value="'Asap', sans-serif" style="font-family:'Asap', sans-serif;">Asap</option>
          <option value="'Karla', sans-serif" style="font-family:'Karla', sans-serif;">Karla</option>
          <option value="'Manrope', sans-serif" style="font-family:'Manrope', sans-serif;">Manrope</option>
          <option value="'Titillium Web', sans-serif" style="font-family:'Titillium Web', sans-serif;">Titillium Web</option>
          <option value="'Exo 2', sans-serif" style="font-family:'Exo 2', sans-serif;">Exo 2</option>
          <option value="'Signika', sans-serif" style="font-family:'Signika', sans-serif;">Signika</option>
          <option value="'Hind', sans-serif" style="font-family:'Hind', sans-serif;">Hind</option>
          <option value="'Archivo', sans-serif" style="font-family:'Archivo', sans-serif;">Archivo</option>
          <option value="'Questrial', sans-serif" style="font-family:'Questrial', sans-serif;">Questrial</option>
          <option value="'Heebo', sans-serif" style="font-family:'Heebo', sans-serif;">Heebo</option>
          <option value="'Fira Sans', sans-serif" style="font-family:'Fira Sans', sans-serif;">Fira Sans</option>
          <option value="'Assistant', sans-serif" style="font-family:'Assistant', sans-serif;">Assistant</option>
          <option value="'Lexend', sans-serif" style="font-family:'Lexend', sans-serif;">Lexend</option>
          <option value="'Public Sans', sans-serif" style="font-family:'Public Sans', sans-serif;">Public Sans</option>
          <option value="'DM Sans', sans-serif" style="font-family:'DM Sans', sans-serif;">DM Sans</option>
          <option value="'OpenDyslexic', sans-serif" style="font-family:'OpenDyslexic', sans-serif;">OpenDyslexic</option>
        </optgroup>
        <optgroup label="Serif">
          <option value="'EB Garamond', serif" style="font-family:'EB Garamond', serif;">EB Garamond</option>
          <option value="'Merriweather', serif" style="font-family:'Merriweather', serif;">Merriweather</option>
          <option value="'Playfair Display', serif" style="font-family:'Playfair Display', serif;">Playfair Display</option>
          <option value="'Roboto Serif', serif" style="font-family:'Roboto Serif', serif;">Roboto Serif</option>
          <option value="'PT Serif', serif" style="font-family:'PT Serif', serif;">PT Serif</option>
          <option value="'Crimson Text', serif" style="font-family:'Crimson Text', serif;">Crimson Text</option>
          <option value="'Libre Baskerville', serif" style="font-family:'Libre Baskerville', serif;">Libre Baskerville</option>
          <option value="'Source Serif 4', serif" style="font-family:'Source Serif 4', serif;">Source Serif 4</option>
          <option value="'Domine', serif" style="font-family:'Domine', serif;">Domine</option>
          <option value="'Spectral', serif" style="font-family:'Spectral', serif;">Spectral</option>
          <option value="'Cardo', serif" style="font-family:'Cardo', serif;">Cardo</option>
          <option value="'Vollkorn', serif" style="font-family:'Vollkorn', serif;">Vollkorn</option>
          <option value="'Crete Round', serif" style="font-family:'Crete Round', serif;">Crete Round</option>
          <option value="'Arvo', serif" style="font-family:'Arvo', serif;">Arvo</option>
          <option value="'Old Standard TT', serif" style="font-family:'Old Standard TT', serif;">Old Standard TT</option>
          <option value="'Prata', serif" style="font-family:'Prata', serif;">Prata</option>
          <option value="'Zilla Slab', serif" style="font-family:'Zilla Slab', serif;">Zilla Slab</option>
          <option value="'Literata', serif" style="font-family:'Literata', serif;">Literata</option>
          <option value="'Georgia Pro', serif" style="font-family:'Georgia Pro', serif;">Georgia Pro</option>
          <option value="'Faustina', serif" style="font-family:'Faustina', serif;">Faustina</option>
          <option value="'PT Mono', serif" style="font-family:'PT Mono', serif;">PT Mono</option>
          <option value="'Neuton', serif" style="font-family:'Neuton', serif;">Neuton</option>
          <option value="'Sorts Mill Goudy', serif" style="font-family:'Sorts Mill Goudy', serif;">Sorts Mill Goudy</option>
          <option value="'Alice', serif" style="font-family:'Alice', serif;">Alice</option>
          <option value="'Gloock', serif" style="font-family:'Gloock', serif;">Gloock</option>
          <option value="'Trirong', serif" style="font-family:'Trirong', serif;">Trirong</option>
          <option value="'Noticia Text', serif" style="font-family:'Noticia Text', serif;">Noticia Text</option>
          <option value="'Abhaya Libre', serif" style="font-family:'Abhaya Libre', serif;">Abhaya Libre</option>
          <option value="'Libre Caslon Text', serif" style="font-family:'Libre Caslon Text', serif;">Libre Caslon Text</option>
          <option value="'Martel', serif" style="font-family:'Martel', serif;">Martel</option>
        </optgroup>
        <optgroup label="Monospace">
          <option value="'Fira Mono', monospace" style="font-family:'Fira Mono', monospace;">Fira Mono</option>
          <option value="'JetBrains Mono', monospace" style="font-family:'JetBrains Mono', monospace;">JetBrains Mono</option>
          <option value="'Roboto Mono', monospace" style="font-family:'Roboto Mono', monospace;">Roboto Mono</option>
          <option value="'Source Code Pro', monospace" style="font-family:'Source Code Pro', monospace;">Source Code Pro</option>
          <option value="'IBM Plex Mono', monospace" style="font-family:'IBM Plex Mono', monospace;">IBM Plex Mono</option>
          <option value="'Space Mono', monospace" style="font-family:'Space Mono', monospace;">Space Mono</option>
          <option value="'Cascadia Code', monospace" style="font-family:'Cascadia Code', monospace;">Cascadia Code</option>
          <option value="'Inconsolata', monospace" style="font-family:'Inconsolata', monospace;">Inconsolata</option>
          <option value="'Ubuntu Mono', monospace" style="font-family:'Ubuntu Mono', monospace;">Ubuntu Mono</option>
          <option value="'Anonymous Pro', monospace" style="font-family:'Anonymous Pro', monospace;">Anonymous Pro</option>
          <option value="'Share Tech Mono', monospace" style="font-family:'Share Tech Mono', monospace;">Share Tech Mono</option>
          <option value="'Cutive Mono', monospace" style="font-family:'Cutive Mono', monospace;">Cutive Mono</option>
          <option value="'Oxygen Mono', monospace" style="font-family:'Oxygen Mono', monospace;">Oxygen Mono</option>
          <option value="'Overpass Mono', monospace" style="font-family:'Overpass Mono', monospace;">Overpass Mono</option>
          <option value="'Major Mono Display', monospace" style="font-family:'Major Mono Display', monospace;">Major Mono Display</option>
          <option value="'Nanum Gothic Coding', monospace" style="font-family:'Nanum Gothic Coding', monospace;">Nanum Gothic Coding</option>
          <option value="'Red Hat Mono', monospace" style="font-family:'Red Hat Mono', monospace;">Red Hat Mono</option>
          <option value="'VT323', monospace" style="font-family:'VT323', monospace;">VT323</option>
          <option value="'Syne Mono', monospace" style="font-family:'Syne Mono', monospace;">Syne Mono</option>
          <option value="'Recursive', monospace" style="font-family:'Recursive', monospace;">Recursive</option>
          <option value="'Nova Mono', monospace" style="font-family:'Nova Mono', monospace;">Nova Mono</option>
          <option value="'Enriqueta', monospace" style="font-family:'Enriqueta', monospace;">Enriqueta</option>
          <option value="'Special Elite', monospace" style="font-family:'Special Elite', monospace;">Special Elite</option>
          <option value="'Press Start 2P', monospace" style="font-family:'Press Start 2P', monospace;">Press Start 2P</option>
          <option value="'Mononoki', monospace" style="font-family:'Mononoki', monospace;">Mononoki</option>
          <option value="'IBM Plex Mono', monospace" style="font-family:'IBM Plex Mono', monospace;">IBM Plex Mono</option>
          <option value="'PT Mono', monospace" style="font-family:'PT Mono', monospace;">PT Mono</option>
          <option value="'Fira Code', monospace" style="font-family:'Fira Code', monospace;">Fira Code</option>
          <option value="'Anonymous Pro', monospace" style="font-family:'Anonymous Pro', monospace;">Anonymous Pro</option>
          <option value="'Courier Prime', monospace" style="font-family:'Courier Prime', monospace;">Courier Prime</option>
        </optgroup>
      </select>
    </div>
  `;

    // Theme pickers logic
  const accentPicker = document.getElementById("accent-color-picker");
  const textPicker = document.getElementById("text-color-picker");
  const bgPicker = document.getElementById("bg-color-picker");
  const resetBtn = document.getElementById("reset-theme-btn");
  const darkModeToggle = document.getElementById("dark-mode-toggle");

  function setThemeVars(accent, text, bg) {
    app.style.setProperty("--accent-color", accent);
    app.style.setProperty("--text-color", text);
    app.style.setProperty("--bg-color", bg);
    localStorage.setItem("custom-theme", JSON.stringify({accent, text, bg}));
    // Disable dark mode toggle when custom theme is set
    darkModeToggle.disabled = true;
    app.classList.remove("dark");
    app.classList.add("light");
  }

function resetThemeVars() {
  // Remove inline custom theme variables so class-based ones take effect
  app.style.removeProperty("--accent-color");
  app.style.removeProperty("--text-color");
  app.style.removeProperty("--bg-color");
  localStorage.removeItem("custom-theme");
  darkModeToggle.disabled = false;
  darkModeToggle.removeAttribute("disabled");
  darkModeToggle.checked = darkMode; // Sync toggle state with darkMode variable

  // Restore dark/light mode
  if (darkMode) {
    app.classList.add("dark");
    app.classList.remove("light");
  } else {
    app.classList.remove("dark");
    app.classList.add("light");
  }

  // Force a change event to ensure the UI and logic are in sync
  const event = new Event('change', { bubbles: true });
  darkModeToggle.dispatchEvent(event);
}
  accentPicker.addEventListener("input", () => {
    setThemeVars(accentPicker.value, textPicker.value, bgPicker.value);
  });
  textPicker.addEventListener("input", () => {
    setThemeVars(accentPicker.value, textPicker.value, bgPicker.value);
  });
  bgPicker.addEventListener("input", () => {
    setThemeVars(accentPicker.value, textPicker.value, bgPicker.value);
  });
resetBtn.addEventListener("click", () => {
  resetThemeVars();
  accentPicker.value = "#4169e1";
  textPicker.value = "#000000";
  bgPicker.value = "#ffffff";
});

  // On load, apply custom theme if present
  const savedTheme = localStorage.getItem("custom-theme");
  if (savedTheme) {
    const {accent, text, bg} = JSON.parse(savedTheme);
    setThemeVars(accent, text, bg);
    accentPicker.value = accent;
    textPicker.value = text;
    bgPicker.value = bg;
  }

  // Font search filter
  const searchInput = document.getElementById('font-family-search');
  const fontSelect = document.getElementById('font-family-select');
  searchInput.addEventListener('input', () => {
    const filter = searchInput.value.toLowerCase();
    for (const option of fontSelect.options) {
      if (option.tagName === 'OPTION') {
        const text = option.textContent.toLowerCase();
        option.style.display = text.includes(filter) ? '' : 'none';
      }
    }
  });

  // Dark mode toggle
  settingsDiv
    .querySelector("#dark-mode-toggle")
    .addEventListener("change", (e) => {
      darkMode = e.target.checked;
      if (darkMode) {
        app.classList.add("dark");
        app.classList.remove("light");
      } else {
        app.classList.remove("dark");
        app.classList.add("light");
      }
    });

  // Font size slider
  settingsDiv
    .querySelector("#font-size-range")
    .addEventListener("input", (e) => {
      fontSize = e.target.value;
      app.style.setProperty("--font-size", `${fontSize}px`);
      e.target.previousElementSibling.textContent = `Text Size (${fontSize}px)`;
    });

  // Font family selector
  settingsDiv
    .querySelector("#font-family-select")
    .addEventListener("change", (e) => {
      fontFamily = e.target.value;
      app.style.setProperty("--text-font", fontFamily);
    });

  // Set font on load
  app.style.setProperty("--text-font", fontFamily);
}
  let debounceTimer;
  searchInput.addEventListener("input", () => {
    clearTimeout(debounceTimer);
    const q = searchInput.value.trim();
    debounceTimer = setTimeout(() => {
      if (currentTab === "wiki") {
        wikiSearch(q);
      } else if (currentTab === "dic") {
        dicSearch(q);
      } else if (currentTab === "thes") {
        thesSearch(q);
      }
    }, 400);
  });

  switchTab("wiki");

  // Initialise theme
  app.classList.add("light");
  app.style.setProperty("--font-size", `${fontSize}px`);
  app.style.setProperty("--text-font", fontFamily);

})();

function updateClock() {
  const now = new Date();

  const time = now.toLocaleTimeString([], {
    hour: "numeric",
    minute: "2-digit",
  });

  const dayOfWeek = now.toLocaleDateString(undefined, { weekday: 'short' });
  const day = now.getDate();
  const month = now.toLocaleDateString(undefined, { month: 'short' });
  const year = now.getFullYear();

  function getOrdinal(n) {
    if (n > 3 && n < 21) return 'th';
    switch (n % 10) {
      case 1: return 'st';
      case 2: return 'nd';
      case 3: return 'rd';
      default: return 'th';
    }
  }

  const date = `${day}${getOrdinal(day)}`;

  document.getElementById("time").textContent = time;
  document.getElementById("date").textContent = `${dayOfWeek}, ${date} ${month}, ${year}`;
}

setInterval(updateClock, 1000);
updateClock();


document.addEventListener("DOMContentLoaded", () => {
  const versionLabel = document.getElementById("versionLabel");
  const versionDetails = document.getElementById("versionDetails");

  const updates = `
    <div style="position: relative;">
      <strong>v.2.1.1 changes:</strong>
      <ul>
        <li>Added Table of Contents in Wikipedia Tab</li>
        </ul>
        <a href="https://github.com/Pidgeron/The-Compendium-of-Everything/tree/main" target="_blank" style="color: var(--accent-color); text-decoration: none;">
        View project on GitHub
        </a>
        <br>
        <a href="https://www.compendiumofeverything.org/beta" target="_blank" style="color: var(--accent-color); text-decoration: none; margin-left: 10px;">
        View Beta version
        </a>
      <div>
      <span id="closeUpdates" class="material-symbols-rounded" style="position: absolute; top: 6px; right: 10px; cursor: pointer; font-size: 1.4em; font-family: var(--text-font 'Roboto'), sans-serif;">close</span>
    </div>
  `;

  versionLabel.addEventListener("click", () => {
    if (versionDetails.style.display === "none" || !versionDetails.style.display) {
      versionDetails.innerHTML = updates;
      versionDetails.style.display = "block";

      const closeBtn = document.getElementById("closeUpdates");
      if (closeBtn) {
        closeBtn.addEventListener("click", () => {
          versionDetails.style.display = "none";
        });
      }
    } else {
      versionDetails.style.display = "none";
    }
  });
});



// About panel logic
const authorTitle = document.querySelector('.author-title');
const versionDetails = document.getElementById("versionDetails");

// Create about panel
const aboutPanel = document.createElement('div');
aboutPanel.id = "aboutPanel";
aboutPanel.className = "about-panel";
aboutPanel.style.display = "none";
aboutPanel.innerHTML = `
  <div style="position: relative;">
    <img src="Compendium_Logo.png" alt="Compendium Logo" class="about-logo">
    <h2 style="margin-top:10px;">The Compendium of Everything</h2>
    <p>
      A multi-tool web app for quick access to Wikipedia, dictionary, thesaurus, weather, and more.<br>
      Created by <b>Liam C. Smalley</b>.<br>
      <span style="font-size:13px; color:#888;">Copyright &copy; 2025</span>
    </p>
    <span id="closeAbout" class="material-symbols-rounded about-close">close</span>
  </div>
`;
document.body.appendChild(aboutPanel);

// Show/hide About panel, ensure only one panel is open
authorTitle.addEventListener("click", () => {
  // Hide version panel if open
  versionDetails.style.display = "none";
  // Toggle about panel
  aboutPanel.style.display = aboutPanel.style.display === "block" ? "none" : "block";
});

aboutPanel.querySelector("#closeAbout").addEventListener("click", () => {
  aboutPanel.style.display = "none";
});

// Hide about panel if version label is clicked
document.getElementById("versionLabel").addEventListener("click", () => {
  aboutPanel.style.display = "none";
});
//Copyright 2025 by L. Smalley
    </script>
    </body>
</html>
